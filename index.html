const socket = io();
    let currentUser = JSON.parse(localStorage.getItem('coluz_user')) || {};

    // Si ya tiene sesi칩n guardada, saltamos el login
    if(currentUser.gmail) {
        document.getElementById('login-screen').style.display = 'none';
        updateSidebarProfile();
    }

    function login() {
        const u = document.getElementById('username').value;
        const t = document.getElementById('usertag').value;
        const g = document.getElementById('usergmail').value;
        if(!u || !t || !g) return alert("Rellena todo, cabr칩n.");
        
        currentUser = { name: u, tag: t, gmail: g, role: 'USER', desc: "Chateando en Coluz", pfp: "" };
        localStorage.setItem('coluz_user', JSON.stringify(currentUser));
        
        document.getElementById('login-screen').style.display = 'none';
        updateSidebarProfile();
    }

    // ACTUALIZAR PERFIL EN LA BARRA LATERAL
    function updateSidebarProfile() {
        document.getElementById('p-name').innerText = currentUser.name;
        document.getElementById('p-desc').innerText = currentUser.desc;
        if(currentUser.pfp) {
            document.getElementById('p-avatar').innerHTML = `<img src="${currentUser.pfp}" style="width:100%; height:100%; border-radius:50%;">`;
        }
    }

    // ABRIR EDICI칍N DE PERFIL (Al tocar tu perfil)
    function openEditProfile() {
        const newName = prompt("Nuevo Nickname:", currentUser.name);
        const newDesc = prompt("Nueva Descripci칩n:", currentUser.desc);
        const newPfp = prompt("Pega el link de tu imagen (URL):", currentUser.pfp);
        
        if(newName) currentUser.name = newName;
        if(newDesc) currentUser.desc = newDesc;
        if(newPfp) currentUser.pfp = newPfp;
        
        localStorage.setItem('coluz_user', JSON.stringify(currentUser));
        updateSidebarProfile();
        alert("Perfil actualizado, galactomany.");
    }

    // SISTEMA DE AMIGOS (B치sico por ahora)
    function addFriend() {
        const tag = prompt("Introduce el @UserTag de tu amigo:");
        if(tag) {
            const list = document.getElementById('friends-list');
            const div = document.createElement('div');
            div.className = 'channel-item';
            div.innerHTML = `游녻 ${tag}`;
            div.onclick = () => alert("Abriendo chat privado con " + tag);
            list.appendChild(div);
            alert("Solicitud enviada a " + tag);
        }
    }

    // --- EL RESTO DEL C칍DIGO DE MENSAJES SE QUEDA IGUAL ---
</script>
</body>
</html>

